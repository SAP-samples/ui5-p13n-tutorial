"use strict";sap.ui.define(["sap/m/Table","sap/m/p13n/Engine","sap/m/p13n/SelectionController","sap/m/p13n/MetadataHelper","sap/m/Text","sap/m/p13n/SortController","sap/m/p13n/GroupController","sap/ui/model/Sorter","sap/m/p13n/FilterController","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/Label"],function(t,e,n,s,i,o,r,a,l,h,c,p){"use strict";const u=t.extend("sample.p13n.app.control.P13nTable",{renderer:"sap/m/TableRenderer",constructor:function n(s,i){t.prototype.constructor.call(this,s,i);this.engine=e.getInstance();this.initialized=new Promise(t=>{this.attachEventOnce("updateFinished",()=>{this.initP13n();t()},this)})},initP13n:function t(){const e=this.getColumns();const i=e.map((t,e)=>{const n=t.getHeader();const s=this.getItems()[0];const i=s.getCells()[e];return{key:t.data("p13nKey"),label:n.getText(false),path:i.getBinding(i.isA("sap.m.ObjectIdentifier")?"title":"text").getPath()}});this.helper=new s(i);this.engine.register(this,{helper:this.helper,controller:{Columns:new n({control:this,targetAggregation:"columns"}),Sorter:new o({control:this}),Groups:new r({control:this}),Filter:new l({control:this})}});this.engine.attachStateChange(t=>{const e=t.getParameters();if(e["control"]===this){this.onStateChange(e["state"])}})},onStateChange:function t(e){this.getColumns().forEach(t=>{t.setVisible(e.Columns.some(e=>t.data("p13nKey")===e.key))});e.Columns.forEach(this.moveColum,this);const n=[];e.Groups.forEach(t=>{n.push(new a(this.helper.getPath(t.key),undefined,true))});e.Sorter.forEach(t=>{n.push(new a(this.helper.getPath(t.key),t.descending))});const s=[];let i;Object.keys(e.Filter).forEach(t=>{const n=this.helper.getProperty(t).label;i=i?i+", "+n:n;const o=this.helper.getPath(t);e.Filter[t].forEach(t=>{const e=t.operator;s.push(new h(o,e,t.values[0]))})});const o=this.getBinding("items");o?.sort(n);o?.filter(s);this.setFilterInfoText(i)},moveColum:function t(e,n){const s=this.getColumns().find(t=>t.data("p13nKey")===e.key);if(s===undefined)return;const i=this.getColumns().indexOf(s);if(n!=i){this.removeColumn(s);this.insertColumn(s,n);const t=t=>{if(t?.isA("sap.m.ColumnListItem")){const e=t.removeCell(i);if(e!=null)t.insertCell(e,n)}};const e=this.getBindingInfo("items");t(e.template);this.getItems().forEach(e=>t(e))}},openP13n:function t(e){this.engine.show(this,["Columns","Sorter","Groups","Filter"],{title:"Table Settings",source:e.getSource()})},setFilterInfoText:function t(e){const n=this.getInfoToolbar();if(e&&!n){this.setInfoToolbar(new c({design:"Info",active:true,content:[new i({text:"Filtered by:"}),new p({text:e})]}))}else if(e){const t=n.getContent()[1];t.setText(e)}else if(n){n.destroy()}},applyState:async function t(e){await this.initialized;return this.engine.applyState(this,e)},retrieveState:async function t(){await this.initialized;return this.engine.retrieveState(this)}});return u});
//# sourceMappingURL=P13nTable.js.map